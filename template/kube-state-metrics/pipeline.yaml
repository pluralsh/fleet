apiVersion: deployments.plural.sh/v1alpha1
kind: Pipeline
metadata:
  name: {{ context.fleetName }}-kube-state-metrics
spec:
  stages:
    - name: dev
      services:
        - serviceRef:
            name: kube-state-metrics-dev
            namespace: {{ context.fleetName }}
          criteria:
            prAutomationRef:
              name: {{ context.fleetName }}-kube-state-metrics
    - name: prod
      services:
        - serviceRef:
            name: kube-state-metrics-prod
            namespace: {{ context.fleetName }}
          criteria:
            prAutomationRef:
              name: {{ context.fleetName }}-kube-state-metrics
  edges:
    - from: dev
      to: prod
      gates:
      - name: approval-gate
        type: APPROVAL